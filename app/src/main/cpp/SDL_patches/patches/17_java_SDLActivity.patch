diff --git a/D:/RotatingartLauncher/app/src/main/cpp/SDL_original_2301/android-project/app/src/main/java/org/libsdl/app/SDLActivity.java b/D:/RotatingartLauncher/app/src/main/java/org/libsdl/app/SDLActivity.java
index fd5a056e3..a216c9f6c 100644
--- a/D:/RotatingartLauncher/app/src/main/cpp/SDL_original_2301/android-project/app/src/main/java/org/libsdl/app/SDLActivity.java
+++ b/D:/RotatingartLauncher/app/src/main/java/org/libsdl/app/SDLActivity.java
@@ -25,7 +25,6 @@ import android.os.Handler;
 import android.os.Message;
 import android.text.Editable;
 import android.text.InputType;
-import android.text.Selection;
 import android.util.DisplayMetrics;
 import android.util.Log;
 import android.util.SparseArray;
@@ -50,21 +49,21 @@ import android.widget.RelativeLayout;
 import android.widget.TextView;
 import android.widget.Toast;
 
+import androidx.fragment.app.FragmentActivity;
+
 import java.util.Hashtable;
 import java.util.Locale;
 
-
 /**
     SDL Activity
 */
-public class SDLActivity extends Activity implements View.OnSystemUiVisibilityChangeListener {
+public class SDLActivity extends FragmentActivity implements View.OnSystemUiVisibilityChangeListener {
     private static final String TAG = "SDL";
     private static final int SDL_MAJOR_VERSION = 2;
     private static final int SDL_MINOR_VERSION = 30;
     private static final int SDL_MICRO_VERSION = 1;
 /*
     // Display InputType.SOURCE/CLASS of events and devices
-    //
     // SDLActivity.debugSource(device.getSources(), "device[" + device.getName() + "]");
     // SDLActivity.debugSource(event.getSource(), "event");
     public static void debugSource(int sources, String prefix) {
@@ -81,7 +80,6 @@ public class SDLActivity extends Activity implements View.OnSystemUiVisibilityCh
         if ((s & InputDevice.SOURCE_CLASS_POSITION) != 0)   cls += " POSITION";
         if ((s & InputDevice.SOURCE_CLASS_TRACKBALL) != 0)  cls += " TRACKBALL";
 
-
         int s2 = s_copy & ~InputDevice.SOURCE_ANY; // keep class bits
         s2 &= ~(  InputDevice.SOURCE_CLASS_BUTTON
                 | InputDevice.SOURCE_CLASS_JOYSTICK
@@ -165,7 +163,6 @@ public class SDLActivity extends Activity implements View.OnSystemUiVisibilityCh
 
         if (s2 != 0) src += " Some_Unkown";
 
-        Log.v(TAG, prefix + "int=" + s_copy + " CLASS={" + cls + " } source(s):" + src);
     }
 */
 
@@ -319,15 +316,13 @@ public class SDLActivity extends Activity implements View.OnSystemUiVisibilityCh
     // Setup
     @Override
     protected void onCreate(Bundle savedInstanceState) {
-        Log.v(TAG, "Device: " + Build.DEVICE);
-        Log.v(TAG, "Model: " + Build.MODEL);
-        Log.v(TAG, "onCreate()");
+
         super.onCreate(savedInstanceState);
 
         try {
             Thread.currentThread().setName("SDLActivity");
         } catch (Exception e) {
-            Log.v(TAG, "modify thread properties failed " + e.toString());
+
         }
 
         // Load shared libraries
@@ -423,7 +418,7 @@ public class SDLActivity extends Activity implements View.OnSystemUiVisibilityCh
         if (intent != null && intent.getData() != null) {
             String filename = intent.getData().getPath();
             if (filename != null) {
-                Log.v(TAG, "Got filename: " + filename);
+
                 SDLActivity.onNativeDropFile(filename);
             }
         }
@@ -454,7 +449,7 @@ public class SDLActivity extends Activity implements View.OnSystemUiVisibilityCh
     // Events
     @Override
     protected void onPause() {
-        Log.v(TAG, "onPause()");
+
         super.onPause();
 
         if (mHIDDeviceManager != null) {
@@ -467,7 +462,7 @@ public class SDLActivity extends Activity implements View.OnSystemUiVisibilityCh
 
     @Override
     protected void onResume() {
-        Log.v(TAG, "onResume()");
+
         super.onResume();
 
         if (mHIDDeviceManager != null) {
@@ -480,7 +475,7 @@ public class SDLActivity extends Activity implements View.OnSystemUiVisibilityCh
 
     @Override
     protected void onStop() {
-        Log.v(TAG, "onStop()");
+
         super.onStop();
         if (mHasMultiWindow) {
             pauseNativeThread();
@@ -489,7 +484,7 @@ public class SDLActivity extends Activity implements View.OnSystemUiVisibilityCh
 
     @Override
     protected void onStart() {
-        Log.v(TAG, "onStart()");
+
         super.onStart();
         if (mHasMultiWindow) {
             resumeNativeThread();
@@ -529,7 +524,6 @@ public class SDLActivity extends Activity implements View.OnSystemUiVisibilityCh
     @Override
     public void onWindowFocusChanged(boolean hasFocus) {
         super.onWindowFocusChanged(hasFocus);
-        Log.v(TAG, "onWindowFocusChanged(): " + hasFocus);
 
         if (SDLActivity.mBrokenLibraries) {
            return;
@@ -554,7 +548,7 @@ public class SDLActivity extends Activity implements View.OnSystemUiVisibilityCh
 
     @Override
     public void onLowMemory() {
-        Log.v(TAG, "onLowMemory()");
+
         super.onLowMemory();
 
         if (SDLActivity.mBrokenLibraries) {
@@ -566,7 +560,7 @@ public class SDLActivity extends Activity implements View.OnSystemUiVisibilityCh
 
     @Override
     public void onConfigurationChanged(Configuration newConfig) {
-        Log.v(TAG, "onConfigurationChanged()");
+
         super.onConfigurationChanged(newConfig);
 
         if (SDLActivity.mBrokenLibraries) {
@@ -581,7 +575,6 @@ public class SDLActivity extends Activity implements View.OnSystemUiVisibilityCh
 
     @Override
     protected void onDestroy() {
-        Log.v(TAG, "onDestroy()");
 
         if (mHIDDeviceManager != null) {
             HIDDeviceManager.release(mHIDDeviceManager);
@@ -604,7 +597,7 @@ public class SDLActivity extends Activity implements View.OnSystemUiVisibilityCh
             try {
                 SDLActivity.mSDLThread.join();
             } catch(Exception e) {
-                Log.v(TAG, "Problem stopping SDLThread: " + e);
+
             }
         }
 
@@ -616,10 +609,8 @@ public class SDLActivity extends Activity implements View.OnSystemUiVisibilityCh
     @Override
     public void onBackPressed() {
         // Check if we want to block the back button in case of mouse right click.
-        //
         // If we do, the normal hardware back button will no longer work and people have to use home,
         // but the mouse right click will work.
-        //
         boolean trapBack = SDLActivity.nativeGetHintBoolean("SDL_ANDROID_TRAP_BACK_BUTTON", false);
         if (trapBack) {
             // Exit and let the mouse handler handle this button (if appropriate)
@@ -703,13 +694,18 @@ public class SDLActivity extends Activity implements View.OnSystemUiVisibilityCh
 
         // Try a transition to resumed state
         if (mNextNativeState == NativeState.RESUMED) {
-            if (mSurface.mIsSurfaceReady && mHasFocus && mIsResumedCalled) {
+            // 娣诲姞 mSurface null 妫€鏌ラ槻姝?NullPointerException
+            // 褰?SDL_Init 浠庡叾浠栫嚎绋嬭皟鐢ㄦ椂锛宮Surface 鍙兘杩樻湭鍒濆鍖?+            if (mSurface != null && mSurface.mIsSurfaceReady && mHasFocus && mIsResumedCalled) {
                 if (mSDLThread == null) {
                     // This is the entry point to the C app.
                     // Start up the C app thread and enable sensor input for the first time
-                    // FIXME: Why aren't we enabling sensor input at start?
 
-                    mSDLThread = new Thread(new SDLMain(), "SDLThread");
+                    // [WARN] 鍏抽敭锛氫负 SDL 涓荤嚎绋嬭缃?16MB 鏍堝ぇ灏忥紙闃叉鏍堟孩鍑猴級
+                    // 澶嶆潅娓告垙 + SDL JNI鍥炶皟 闇€瑕佹洿澶х殑鏍堢┖闂?+                    mSDLThread = new Thread(null, new SDLMain(), "SDLThread", 8 * 1024 * 1024); // 16MB stack
+                    mSDLThread.setPriority(Thread.MAX_PRIORITY);
+                    
                     mSurface.enableSensor(Sensor.TYPE_ACCELEROMETER, true);
                     mSDLThread.start();
 
@@ -724,6 +720,13 @@ public class SDLActivity extends Activity implements View.OnSystemUiVisibilityCh
         }
     }
 
+    protected void Main(String[] args) {
+        String library = getMainSharedObject();
+        String function = getMainFunction();
+
+        nativeRunMain(library, function, args);
+    }
+
     // Messages from the SDLMain thread
     static final int COMMAND_CHANGE_TITLE = 1;
     static final int COMMAND_CHANGE_WINDOW_STYLE = 2;
@@ -808,7 +811,9 @@ public class SDLActivity extends Activity implements View.OnSystemUiVisibilityCh
 
                     mScreenKeyboardShown = false;
 
-                    mSurface.requestFocus();
+                    if (mSurface != null) {
+                        mSurface.requestFocus();
+                    }
                 }
                 break;
             case COMMAND_SET_KEEP_SCREEN_ON:
@@ -856,7 +861,9 @@ public class SDLActivity extends Activity implements View.OnSystemUiVisibilityCh
                     DisplayMetrics realMetrics = new DisplayMetrics();
                     display.getRealMetrics(realMetrics);
 
-                    boolean bFullscreenLayout = ((realMetrics.widthPixels == mSurface.getWidth()) &&
+                    // 娣诲姞 mSurface null 妫€鏌?+                    boolean bFullscreenLayout = (mSurface != null) &&
+                            ((realMetrics.widthPixels == mSurface.getWidth()) &&
                             (realMetrics.heightPixels == mSurface.getHeight()));
 
                     if ((Integer) data == 1) {
@@ -879,11 +886,9 @@ public class SDLActivity extends Activity implements View.OnSystemUiVisibilityCh
                     // when called.  That way, we know our current size is really the
                     // size we need, instead of grabbing a size that's still got
                     // the navigation and/or status bars before they're hidden.
-                    //
                     // We'll wait for up to half a second, because some devices
                     // take a surprisingly long time for the surface resize, but
                     // then we'll just give up and return.
-                    //
                     synchronized (SDLActivity.getContext()) {
                         try {
                             SDLActivity.getContext().wait(500);
@@ -902,6 +907,8 @@ public class SDLActivity extends Activity implements View.OnSystemUiVisibilityCh
     public static native String nativeGetVersion();
     public static native int nativeSetupJNI();
     public static native int nativeRunMain(String library, String function, Object arguments);
+    public static native int nativeAndroidJNISetEnvCurrent();
+    public static native int nativeAndroidJNISetEnvNull();
     public static native void nativeLowMemory();
     public static native void nativeSendQuit();
     public static native void nativeQuit();
@@ -916,9 +923,18 @@ public class SDLActivity extends Activity implements View.OnSystemUiVisibilityCh
     public static native boolean onNativeSoftReturnKey();
     public static native void onNativeKeyboardFocusLost();
     public static native void onNativeMouse(int button, int action, float x, float y, boolean relative);
+    public static native void onNativeMouseDirect(int button, int action, float x, float y, boolean relative);
+    public static native void onNativeMouseButton(int sdlButton, int pressed, float x, float y);
+    public static native void onNativeMouseButtonOnly(int sdlButton, int pressed);
+    public static native int nativeGetMouseStateX();
+    public static native int nativeGetMouseStateY();
     public static native void onNativeTouch(int touchDevId, int pointerFingerId,
                                             int action, float x,
                                             float y, float p);
+    // 铏氭嫙鎺т欢瑙︽懜鐐圭鐞?- 琚爣璁扮殑瑙︽懜鐐逛笉浼氳浆鎹负榧犳爣浜嬩欢
+    public static native void nativeConsumeFingerTouch(int fingerId);
+    public static native void nativeReleaseFingerTouch(int fingerId);
+    public static native void nativeClearConsumedFingers();
     public static native void onNativeAccel(float x, float y, float z);
     public static native void onNativeClipboardChanged();
     public static native void onNativeSurfaceCreated();
@@ -1022,7 +1038,6 @@ public class SDLActivity extends Activity implements View.OnSystemUiVisibilityCh
             }
         }
 
-        Log.v(TAG, "setOrientation() requestedOrientation=" + req + " width=" + w +" height="+ h +" resizable=" + resizable + " hint=" + hint);
         mSingleton.setRequestedOrientation(req);
     }
 
@@ -1090,11 +1105,9 @@ public class SDLActivity extends Activity implements View.OnSystemUiVisibilityCh
     {
         // DeX mode in Samsung Experience 9.0 and earlier doesn't support relative mice properly under
         // Android 7 APIs, and simply returns no data under Android 8 APIs.
-        //
         // This is fixed in Samsung Experience 9.5, which corresponds to Android 8.1.0, and
         // thus SDK version 27.  If we are in DeX mode and not API 27 or higher, as a result,
         // we should stick to relative mode.
-        //
         if (Build.VERSION.SDK_INT < 27 /* Android 8.1 (O_MR1) */ && isDeXMode()) {
             return false;
         }
@@ -1231,7 +1244,7 @@ public class SDLActivity extends Activity implements View.OnSystemUiVisibilityCh
             /* environment variables set! */
             return true;
         } catch (Exception e) {
-           Log.v(TAG, "exception " + e.toString());
+
         }
         return false;
     }
@@ -1328,7 +1341,6 @@ public class SDLActivity extends Activity implements View.OnSystemUiVisibilityCh
         // Dispatch the different events depending on where they come from
         // Some SOURCE_JOYSTICK, SOURCE_DPAD or SOURCE_GAMEPAD are also SOURCE_KEYBOARD
         // So, we try to process them as JOYSTICK/DPAD/GAMEPAD events first, if that fails we try them as KEYBOARD
-        //
         // Furthermore, it's possible a game controller has SOURCE_KEYBOARD and
         // SOURCE_JOYSTICK, while its key events arrive from the keyboard source
         // So, retrieve the device itself and check all of its sources
@@ -1381,10 +1393,23 @@ public class SDLActivity extends Activity implements View.OnSystemUiVisibilityCh
      * This method is called by SDL using JNI.
      */
     public static Surface getNativeSurface() {
+        Log.i(TAG, "getNativeSurface() called from JNI");
+        Log.i(TAG, "  mSingleton=" + mSingleton + ", mSurface=" + mSurface);
+        
         if (SDLActivity.mSurface == null) {
+            Log.e(TAG, "  ERROR: mSurface is NULL! SDLActivity not properly initialized?");
             return null;
         }
-        return SDLActivity.mSurface.getNativeSurface();
+        
+        Surface surface = SDLActivity.mSurface.getNativeSurface();
+        Log.i(TAG, "  mSurface.getNativeSurface() returned: " + surface);
+        Log.i(TAG, "  mSurface.mIsSurfaceReady=" + mSurface.mIsSurfaceReady);
+        
+        if (surface == null) {
+            Log.e(TAG, "  ERROR: Surface is NULL! SurfaceHolder not ready?");
+        }
+        
+        return surface;
     }
 
     // Input
@@ -1486,8 +1511,6 @@ public class SDLActivity extends Activity implements View.OnSystemUiVisibilityCh
 
     protected void messageboxCreateAndShow(Bundle args) {
 
-        // TODO set values from "flags" to messagebox dialog
-
         // get colors
 
         int[] colors = args.getIntArray("colors");
@@ -1569,7 +1592,7 @@ public class SDLActivity extends Activity implements View.OnSystemUiVisibilityCh
                 button.setTextColor(textColor);
             }
             if (buttonBorderColor != Color.TRANSPARENT) {
-                // TODO set color for border of messagebox button
+
             }
             if (buttonBackgroundColor != Color.TRANSPARENT) {
                 Drawable drawable = button.getBackground();
@@ -1582,7 +1605,7 @@ public class SDLActivity extends Activity implements View.OnSystemUiVisibilityCh
                 }
             }
             if (buttonSelectedColor != Color.TRANSPARENT) {
-                // TODO set color for selected messagebox button
+
             }
             buttons.addView(button);
         }
@@ -1705,6 +1728,10 @@ public class SDLActivity extends Activity implements View.OnSystemUiVisibilityCh
 
         if (Build.VERSION.SDK_INT >= 24 /* Android 7.0 (N) */) {
             try {
+                // 娣诲姞 mSurface null 妫€鏌?+                if (mSurface == null) {
+                    return false;
+                }
                 mSurface.setPointerIcon(mCursors.get(cursorID));
             } catch (Exception e) {
                 return false;
@@ -1869,21 +1896,26 @@ class SDLMain implements Runnable {
     @Override
     public void run() {
         // Runs SDL_main()
-        String library = SDLActivity.mSingleton.getMainSharedObject();
-        String function = SDLActivity.mSingleton.getMainFunction();
+//        String library = SDLActivity.mSingleton.getMainSharedObject();
+//        String function = SDLActivity.mSingleton.getMainFunction();
         String[] arguments = SDLActivity.mSingleton.getArguments();
 
         try {
+            // set thread priority to max for SDL thread
+            // this helps performance on some devices
+            // set step by step to avoid issues on some devices
+            android.os.Process.setThreadPriority(android.os.Process.THREAD_PRIORITY_MORE_FAVORABLE);
+            android.os.Process.setThreadPriority(android.os.Process.THREAD_PRIORITY_FOREGROUND);
             android.os.Process.setThreadPriority(android.os.Process.THREAD_PRIORITY_DISPLAY);
+            android.os.Process.setThreadPriority(android.os.Process.THREAD_PRIORITY_URGENT_DISPLAY);
         } catch (Exception e) {
-            Log.v("SDL", "modify thread properties failed " + e.toString());
-        }
 
-        Log.v("SDL", "Running main function " + function + " from library " + library);
-
-        SDLActivity.nativeRunMain(library, function, arguments);
+        }
 
-        Log.v("SDL", "Finished main function");
+//        SDLActivity.nativeRunMain(library, function, arguments);
+        SDLActivity.nativeAndroidJNISetEnvCurrent();
+        SDLActivity.mSingleton.Main(arguments);
+        SDLActivity.nativeAndroidJNISetEnvNull();
 
         if (SDLActivity.mSingleton != null && !SDLActivity.mSingleton.isFinishing()) {
             // Let's finish the Activity
@@ -1898,7 +1930,10 @@ class SDLMain implements Runnable {
  * pan&scan region
  */
 class DummyEdit extends View implements View.OnKeyListener {
+    private static final long KEY_DELAY = 40; // milliseconds
+
     InputConnection ic;
+    Handler keyDelayHandler = new Handler();
 
     public DummyEdit(Context context) {
         super(context);
@@ -1914,18 +1949,44 @@ class DummyEdit extends View implements View.OnKeyListener {
 
     @Override
     public boolean onKey(View v, int keyCode, KeyEvent event) {
+        var deviceId = event.getDeviceId();
+        int source = event.getSource();
+        var device = InputDevice.getDevice(deviceId);
+
+        if (source == InputDevice.SOURCE_UNKNOWN && device != null) {
+            source = device.getSources();
+        }
+
+        if (
+            (
+                deviceId == -1 || deviceId == 0 ||
+                (device != null && device.isVirtual() && (source & InputDevice.SOURCE_KEYBOARD) == InputDevice.SOURCE_KEYBOARD) // Virtual keyboard
+            ) &&
+            (
+                keyCode == KeyEvent.KEYCODE_DEL ||
+                keyCode == KeyEvent.KEYCODE_ENTER ||
+                keyCode == KeyEvent.KEYCODE_DPAD_LEFT ||
+                keyCode == KeyEvent.KEYCODE_DPAD_RIGHT ||
+                keyCode == KeyEvent.KEYCODE_DPAD_UP ||
+                keyCode == KeyEvent.KEYCODE_DPAD_DOWN
+            )
+        ) {
+            if (event.getAction() == KeyEvent.ACTION_DOWN) {
+                Log.v("SDL", "handled key down: " + keyCode);
+                SDLActivity.onNativeKeyDown(keyCode);
+                keyDelayHandler.postDelayed(() -> {
+                    SDLActivity.onNativeKeyUp(keyCode);
+                }, KEY_DELAY);
+            }
+            return true;
+        }
         return SDLActivity.handleKeyEvent(v, keyCode, event, ic);
     }
 
-    //
     @Override
     public boolean onKeyPreIme (int keyCode, KeyEvent event) {
         // As seen on StackOverflow: http://stackoverflow.com/questions/7634346/keyboard-hide-event
-        // FIXME: Discussion at http://bugzilla.libsdl.org/show_bug.cgi?id=1639
-        // FIXME: This is not a 100% effective solution to the problem of detecting if the keyboard is showing or not
-        // FIXME: A more effective solution would be to assume our Layout to be RelativeLayout or LinearLayout
-        // FIXME: And determine the keyboard presence doing this: http://stackoverflow.com/questions/2150078/how-to-check-visibility-of-software-keyboard-in-android
-        // FIXME: An even more effective way would be if Android provided this out of the box, but where would the fun be in that :)
+
         if (event.getAction()==KeyEvent.ACTION_UP && keyCode == KeyEvent.KEYCODE_BACK) {
             if (SDLActivity.mTextEdit != null && SDLActivity.mTextEdit.getVisibility() == View.VISIBLE) {
                 SDLActivity.onNativeKeyboardFocusLost();
@@ -2114,4 +2175,3 @@ class SDLClipboardHandler implements
         SDLActivity.onNativeClipboardChanged();
     }
 }
-
